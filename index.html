<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1, user-scalable=no"/>
  <title>Hold‚Äôem&SHOT (.io)</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0e14"/>
  <style>
    :root { --banner-h: 90px; }
    @media (max-width: 768px){ :root { --banner-h: 50px; } }
    html,body{margin:0;height:100%;background:#0b0e14;color:#e6e6e6;font-family:system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;}
    #banner { height: var(--banner-h); display:flex; align-items:center; justify-content:center; background:#0b0e14; border-bottom:1px solid #222; position:sticky; top:0; z-index:2;}
    #wrap { position:relative; height: calc(100dvh - var(--banner-h)); }
    #ui { position:absolute; inset:auto 0 0 0; display:flex; gap:8px; padding:10px; justify-content:center; z-index:1; pointer-events:none;}
    .btn { pointer-events:auto; background:#1b1f2a; border:1px solid #2a2f3a; color:#fff; padding:10px 14px; border-radius:12px; cursor:pointer; }
    .btn:disabled { opacity:.4; cursor:not-allowed; }
    #topbar { position:absolute; top:8px; left:50%; transform:translateX(-50%); display:flex; gap:8px; z-index:1; }
    .chip { background:#101420; border:1px solid #2a2f3a; border-radius:10px; padding:6px 10px; }
    #roomPanel { position:absolute; right:10px; top:8px; background:#101420; border:1px solid #2a2f3a; border-radius:12px; padding:10px; }
    #log { position:absolute; left:10px; top:8px; width:280px; height:160px; overflow:auto; font-size:12px; padding:8px;
           background:#101420; border:1px solid #2a2f3a; border-radius:10px; }
    canvas { display:block; width:100%; height:100%; background:#0b0e14; touch-action: manipulation; }
    #install { position:absolute; left:10px; bottom:10px; }
  </style>
</head>
<body>
  <div id="banner">
    <div style="width:728px; height:90px; display:flex; align-items:center; justify-content:center;">
      <span style="opacity:.6">[Banner Ad Slot]</span>
    </div>
  </div>

  <div id="wrap">
    <canvas id="game"></canvas>

    <div id="topbar">
      <div class="chip" id="phase">WAITING</div>
      <div class="chip" id="turn">-</div>
      <div class="chip" id="timer">‚Äî</div>
    </div>

    <div id="roomPanel">
      <div style="display:flex; gap:6px; margin-bottom:6px;">
        <button class="btn" id="btnQuick">Îπ†Î•∏ Îß§Ïπ≠</button>
        <button class="btn" id="btnCreate">Î∞© ÏΩîÎìú ÏÉùÏÑ±</button>
      </div>
      <div style="display:flex; gap:6px;">
        <input id="roomCode" placeholder="ÏΩîÎìú ÏûÖÎ†•" inputmode="latin" style="width:120px; background:#0b0e14; color:#eee; border:1px solid #2a2f3a; border-radius:8px; padding:6px;">
        <button class="btn" id="btnJoin">ÏûÖÏû•</button>
      </div>
      <div style="margin-top:8px; font-size:12px; opacity:.7;">ÎÇ¥ ÏΩîÎìú: <b id="myCode">-</b></div>
      <div style="margin-top:8px; font-size:12px; opacity:.8;">WS: <span id="wsInfo">auto</span></div>
    </div>

    <pre id="log"></pre>

    <div id="ui">
      <button class="btn" id="btnExchange" disabled>ÍµêÌôò ÏôÑÎ£å</button>
      <button class="btn" id="btnNext" disabled>Îã§Ïùå ÏßÑÌñâ</button>
    </div>
    <button id="install" class="btn" hidden>Ïï± ÏÑ§Ïπò</button>
  </div>

  <!-- üîó Ïó¨Í∏∞ Ìïú Ï§Ñ: Render ÏÑúÎ≤Ñ WebSocket Í≥†Ï†ï -->
  <script>
    window.WS_URL = "wss://holdemnshot.onrender.com/ws";
  </script>

  <!-- PWA ÏÑ§Ïπò & SW Îì±Î°ù -->
  <script>
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
    let deferredPrompt;
    const installBtn = document.getElementById('install');
    window.addEventListener('beforeinstallprompt', (e)=>{
      e.preventDefault(); deferredPrompt = e; installBtn.hidden = false;
    });
    installBtn.addEventListener('click', async ()=>{
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.hidden = true;
    });
    // iOS ÏûÖÎ†• ÌôïÎåÄ Î∞©ÏßÄ
    document.addEventListener('gesturestart', (e)=>e.preventDefault());
  </script>

  <!-- Í≤åÏûÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ -->
  <script type="module" src="client.js"></script>
</body>
</html>
